<script>
const YOUR_NAME = /Si[-\s]?Heon\s+Joo/gi;

function boldAuthor(text) {
  return text.replace(YOUR_NAME, '<strong>$&</strong>');
}

function boldModel(text, model) {
  if (!model) return text;
  const regex = new RegExp(`\\b(${model})\\b`, 'g');
  return text.replace(regex, '<strong>$1</strong>');
}

function createBadge(badge) {
  const el = badge.url
    ? document.createElement('a')
    : document.createElement('span');

  el.className = 'badge';
  el.style.backgroundColor = badge.color || '#777';
  el.textContent = badge.text;

  if (badge.url) {
    el.href = badge.url;
    el.target = '_blank';
  } else {
    el.setAttribute('disabled', 'true');
  }

  return el;
}

function createBibEntry(entry) {
  const container = document.createElement('li');
  container.classList.add('bib-entry');

  const info = document.createElement('div');
  info.className = 'info';

  // badges
  if (entry.badges && Array.isArray(entry.badges)) {
    const badgeContainer = document.createElement('div');
    badgeContainer.className = 'badge-container';
    entry.badges.forEach(b => badgeContainer.appendChild(createBadge(b)));
    info.appendChild(badgeContainer);
  }

  // publication info
  let authors = boldAuthor(entry.author || '');
  let title = boldModel(entry.title || '', entry.model);
  let line = `${authors}. <em>${title}</em>.`;
  if (entry.journal) line += ` <em>${entry.journal}</em>`;
  if (entry.booktitle) line += ` <em>${entry.booktitle}</em>`;
  if (entry.year) line += ` (${entry.year})`;
  if (entry.note) line += `. ${entry.note}`;
  if (entry.doi) line += `. DOI: <a href="https://doi.org/${entry.doi}" target="_blank">${entry.doi}</a>`;

  info.innerHTML += `<div>${line}</div>`;
  container.appendChild(info);

  const rightBox = document.createElement('div');
  rightBox.style.display = 'flex';
  rightBox.style.flexDirection = 'row';
  rightBox.style.alignItems = 'center';
  rightBox.style.gap = '0.5rem';

  if (entry.citation) {
    const cite = document.createElement('span');
    cite.textContent = `Cited by ${entry.citation}`;
    cite.style.fontWeight = '500';
    cite.style.color = '#555';
    rightBox.appendChild(cite);
  }

  if (entry.project) {
    const btn = document.createElement('a');
    btn.href = entry.project;
    btn.target = '_blank';
    btn.className = 'project-button';
    btn.innerText = 'Project Page';
    rightBox.appendChild(btn);
  }

  container.appendChild(rightBox);
  return container;
}

fetch('publications.json')
  .then(res => res.json())
  .then(entries => {
    for (const entry of entries) {
      const type = (entry.type || '').toLowerCase();
      let sectionId = 'publications-list';
      if (type === 'unpublished') sectionId = 'unpublished-list';
      else if (type === 'conference') sectionId = 'conferences-list';

      const el = document.getElementById(sectionId);
      if (el) el.appendChild(createBibEntry(entry));
    }
  });
</script>
